<!-- Services.ejs -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Services</title>
    <link rel="stylesheet" href="/styles/Services.css">
  </head>
  <body>
    <!-- Navbar -->
    <div class="navbar">
      <div class="navbar-logo">Customer View</div>

      <div class="navbar-links">
        <a href="/services" class="navbar-link">Service</a>
        <a href="/products" class="navbar-link">Products</a>
        <a href="/signout" class="signout">Sign Out</a>
      </div>
    </div>

    <!-- Iterate through services and display service cards -->
    <% services.forEach(service => { %>
    <div class="service-card">
      <div class="service-title"><%= service.services %></div>
      <div class="service-price">$<%= service.price %></div>
    </div>
    <% }) %>

    <!-- Customer Form -->
    <div class="form-container">
      <form action="/submitCustomerForm" method="post">
        <h2>Appointment Form</h2>

        <label for="fullName">Full Name:</label>
        <input type="text" id="fullName" name="fullName" required />

        <label for="address">Address:</label>
        <input type="text" id="address" name="address" required />

        <label for="phone">Phone:</label>
        <input type="tel" id="phone" name="phone" required />

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required />

        <label for="selectedServices">Select Services:</label>
        <div class="checkbox-group">
          <% services.forEach(service => { %>
          <label class="checkbox-label">
            <input
              type="checkbox"
              name="selectedServices"
              value="<%= service.services %>"
            />
            <%= service.services %>
          </label>
          <% }) %>
        </div>

        <label for="selectedDay">Select Day:</label>
        <select id="selectedDay" name="selectedDay">
          <% availableDays.forEach(day => { %>
          <option value="<%= day.days %>"><%= day.days %></option>
          <% }) %>
        </select>

        <!-- Add a new select field for mechanic names -->
        <label for="selectedMechanic">Select Mechanic:</label>
        <select id="selectedMechanic" name="selectedMechanic">
          <!-- Mechanic names will be dynamically populated based on the selected day -->
        </select>

        <button type="submit">Submit</button>
      </form>
    </div>

    <script>
      // Fetch mechanic names based on the selected day
      document
        .getElementById("selectedDay")
        .addEventListener("change", function () {
          var selectedDay = this.value;

          // Fetch mechanic names using AJAX (Assuming you have a route to fetch mechanics)
          fetch("/mechanics?selectedDay=" + selectedDay)
            .then((response) => {
              if (!response.ok) {
                throw new Error("Failed to fetch mechanics");
              }
              return response.json();
            })
            .then((data) => {
              var selectMechanic = document.getElementById("selectedMechanic");
              // Clear previous options
              selectMechanic.innerHTML = "";

              // Populate the dropdown with mechanic names and ratings
              if (data.length > 0) {
                data.forEach((mechanic) => {
                  var option = document.createElement("option");
                  option.value = mechanic.Mid; // Assuming Mid is the ID of the mechanic
                  option.text = `${mechanic.fullName} (Rating: ${
                    mechanic.averageRating || "N/A"
                  })`;
                  selectMechanic.add(option);
                });
              } else {
                // If no mechanics are available, display a default option
                var defaultOption = document.createElement("option");
                defaultOption.text = "No Mechanics Available";
                selectMechanic.add(defaultOption);
              }
            })
            .catch((error) => {
              console.error("Error fetching mechanics:", error);
            });
        });

      // Trigger the change event to fetch mechanics when the page loads
      document.getElementById("selectedDay").dispatchEvent(new Event("change"));
    </script>
  </body>
</html>
