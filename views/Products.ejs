<!-- Product.ejs -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Shopping</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/styles/Products.css" />
  </head>
  <body>
    <div class="navbar">
      <div></div>
      <div class="navbar-links">
        <a href="/services" class="navbar-link">Service</a>
        <a href="/products" class="navbar-link">Products</a>
        <a href="/cart" class="navbar-link">Cart</a>
        <a href="/signout" class="signout">Sign Out</a>
      </div>
    </div>

    <div class="shop" id="shop">
      <% products.forEach(product => { %>
      <div class="item">
        <img height="250" width="230" src="<%= product.image_path %>" />
        <div class="details">
          <h3><%= product.name %></h3>
          <p><%= product.description %></p>
          <div class="price-quan">
            <h2>$<%= product.price %></h2>
            <div class="quantity-controls">
              <label for="quantity">Quantity:</label>
              <input
                type="number"
                name="quantity"
                value="1"
                min="1"
                max="<%= product.quantity %>"
                data-product-id="<%= product.Pid %>"
              />
            </div>
            <div class="buttons">
              <form action="/addToCart" method="post">
                <input type="hidden" name="Pid" value="<%= product.Pid %>" />
                <input type="hidden" name="name" value="<%= product.name %>" />
                <input
                  type="hidden"
                  name="description"
                  value="<%= product.description %>"
                />
                <input
                  type="hidden"
                  name="price"
                  value="<%= product.price %>"
                />
                <input
                  type="hidden"
                  name="image_path"
                  value="<%= product.image_path %>"
                />
                <input
                  type="hidden"
                  name="quantity"
                  value="1"
                  id="quantity_<%= product.Pid %>"
                />
                <input type="submit" value="Add To Cart" />
              </form>
            </div>
          </div>
        </div>
      </div>
      <% }); %>
    </div>
    <!-- Include this script in your HTML template -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Add an event listener for input changes
        const quantityInputs = document.querySelectorAll(
          '.quantity-controls input[type="number"]'
        );
        quantityInputs.forEach(function (input) {
          input.addEventListener("input", function () {
            const productId = input.dataset.productId;
            const quantityDisplay = document.querySelector(
              `#quantity_${productId}`
            );
            if (quantityDisplay) {
              quantityDisplay.value = input.value;
            }
          });
        });
      });
    </script>
  </body>
</html>
